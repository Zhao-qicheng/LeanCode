# ç¬¬ä¸€é˜¶æ®µè®­ç»ƒè„šæœ¬è¯´æ˜

## ğŸ“‹ è®­ç»ƒè„šæœ¬æ¸…å•

ç¬¬ä¸€é˜¶æ®µéœ€è¦è®­ç»ƒ 4 ä¸ª base æ¨¡å‹ï¼Œå¯¹åº” 4 ä¸ªè®­ç»ƒè„šæœ¬ï¼š

| è„šæœ¬åç§° | ä»»åŠ¡ | æ¨¡å‹ | tmuxä¼šè¯å | é¢„è®¡æ—¶é—´ |
|---------|------|------|-----------|---------|
| `start_training.sh` | CodeSearch | CodeBERT | `codesearch` | ~æ•°å°æ—¶ |
| `start_training_codesearch_codet5.sh` | CodeSearch | CodeT5 | `codesearch_codet5` | ~æ•°å°æ—¶ |
| `start_training_code2nl_codebert.sh` | Code2NL | CodeBERT | `code2nl_codebert` | ~1-2å¤© |
| `start_training_code2nl_codet5.sh` | Code2NL | CodeT5 | `code2nl_codet5` | ~1-2å¤© |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨è®­ç»ƒ

```bash
# 1. CodeSearch + CodeBERT (å·²åœ¨è¿è¡Œ)
bash start_training.sh

# 2. CodeSearch + CodeT5
bash start_training_codesearch_codet5.sh

# 3. Code2NL + CodeBERT
bash start_training_code2nl_codebert.sh

# 4. Code2NL + CodeT5
bash start_training_code2nl_codet5.sh
```

### æŸ¥çœ‹æ‰€æœ‰è®­ç»ƒä¼šè¯

```bash
tmux ls
```

### è¿›å…¥æŸä¸ªè®­ç»ƒä¼šè¯æŸ¥çœ‹è¿›åº¦

```bash
# è¿›å…¥ CodeSearch + CodeBERT ä¼šè¯
tmux attach -t codesearch

# è¿›å…¥ CodeSearch + CodeT5 ä¼šè¯
tmux attach -t codesearch_codet5

# è¿›å…¥ Code2NL + CodeBERT ä¼šè¯
tmux attach -t code2nl_codebert

# è¿›å…¥ Code2NL + CodeT5 ä¼šè¯
tmux attach -t code2nl_codet5
```

**é€€å‡ºä¼šè¯**: æŒ‰ `Ctrl+B` ç„¶åæŒ‰ `D`ï¼ˆä¼šè¯ä¼šç»§ç»­è¿è¡Œï¼‰

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€æ–°çš„æ—¥å¿—æ–‡ä»¶
ls -lt logs/

# å®æ—¶æŸ¥çœ‹æŸä¸ªæ—¥å¿—
tail -f logs/codesearch_training_XXXXXX.log
tail -f logs/codesearch_codet5_training_XXXXXX.log
tail -f logs/code2nl_codebert_training_XXXXXX.log
tail -f logs/code2nl_codet5_training_XXXXXX.log

# æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
grep -i error logs/xxx.log
```

### åœæ­¢è®­ç»ƒ

```bash
# åœæ­¢æŸä¸ªè®­ç»ƒä»»åŠ¡
tmux kill-session -t codesearch
tmux kill-session -t codesearch_codet5
tmux kill-session -t code2nl_codebert
tmux kill-session -t code2nl_codet5
```

## ğŸ“Š è®­ç»ƒè¿›åº¦ç›‘æ§

### æ£€æŸ¥ GPU ä½¿ç”¨æƒ…å†µ

```bash
nvidia-smi
watch -n 1 nvidia-smi  # æ¯ç§’æ›´æ–°ä¸€æ¬¡
```

### æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€

```bash
ps aux | grep run_classifier  # CodeSearch ä»»åŠ¡
ps aux | grep run.py          # Code2NL CodeBERT ä»»åŠ¡
ps aux | grep run_gen.py      # Code2NL CodeT5 ä»»åŠ¡
```

## ğŸ’¡ å¹¶è¡Œè®­ç»ƒå»ºè®®

### GPU èµ„æºå……è¶³ï¼ˆ2å— RTX 4090ï¼‰

å¦‚æœæƒ³å……åˆ†åˆ©ç”¨åŒ GPUï¼Œå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªè®­ç»ƒä»»åŠ¡ï¼š

**æ¨èæ–¹æ¡ˆ 1**ï¼ˆä¿å®ˆï¼Œé¿å… OOMï¼‰ï¼š
- åŒæ—¶è¿è¡Œ 2 ä¸ªä»»åŠ¡ï¼ˆæ¯ä¸ªä»»åŠ¡ä½¿ç”¨ 1 å— GPUï¼‰

**æ¨èæ–¹æ¡ˆ 2**ï¼ˆæ¿€è¿›ï¼Œå¦‚æœæ˜¾å­˜å……è¶³ï¼‰ï¼š
- åŒæ—¶è¿è¡Œ 4 ä¸ªä»»åŠ¡ï¼ˆbatch size å·²è°ƒå°ï¼‰

### æŒ‰é¡ºåºè®­ç»ƒï¼ˆç¨³å¦¥ï¼‰

1. å…ˆç­‰å¾… `CodeSearch + CodeBERT` å®Œæˆ
2. ä¾æ¬¡è¿è¡Œå…¶ä»–ä¸‰ä¸ªä»»åŠ¡

## ğŸ“ è®­ç»ƒè¾“å‡ºä½ç½®

è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹ä¼šä¿å­˜åœ¨ä»¥ä¸‹ä½ç½®ï¼š

```
models/
â”œâ”€â”€ codesearch/
â”‚   â”œâ”€â”€ codebert/base/     # CodeSearch + CodeBERT
â”‚   â””â”€â”€ codet5/base/       # CodeSearch + CodeT5
â””â”€â”€ code2nl/
    â”œâ”€â”€ codebert/base/     # Code2NL + CodeBERT
    â””â”€â”€ codet5/base/       # Code2NL + CodeT5
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å‡†å¤‡**ï¼šç¡®ä¿å·²æŒ‰ README.md å‡†å¤‡å¥½æ‰€æœ‰æ•°æ®é›†
2. **ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´å­˜å‚¨æ¨¡å‹å’Œæ—¥å¿—ï¼ˆå»ºè®®è‡³å°‘ 50GBï¼‰
3. **SSH æ–­å¼€**ï¼šè®­ç»ƒåœ¨ tmux ä¸­è¿è¡Œï¼ŒSSH æ–­å¼€ä¸å½±å“è®­ç»ƒ
4. **Batch Size**ï¼šå¦‚é‡åˆ° OOM é”™è¯¯ï¼Œå·²ç»è°ƒå°äº† batch sizeï¼ˆ8/4ï¼‰

## ğŸ¯ ä¸‹ä¸€æ­¥

ç¬¬ä¸€é˜¶æ®µè®­ç»ƒå®Œæˆåï¼š

1. âœ… ç”Ÿæˆæƒé‡å­—å…¸ï¼ˆå¦‚æœè®­ç»ƒæ—¶åŠ äº† `--gen_weight`ï¼‰
2. âœ… å‡†å¤‡å‰ªææµ‹è¯•æ•°æ®
3. âœ… è¿›è¡Œç¬¬äºŒé˜¶æ®µçš„å‰ªæå®éªŒï¼ˆ80ä¸ªå®éªŒï¼‰

## ğŸ“ å¸¸è§é—®é¢˜

**Q: å¦‚ä½•çŸ¥é“è®­ç»ƒæ˜¯å¦å®Œæˆï¼Ÿ**  
A: æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æœ«å°¾ï¼Œä¼šæ˜¾ç¤º "âœ“ è®­ç»ƒæˆåŠŸå®Œæˆï¼" æˆ– "âœ— è®­ç»ƒå¤±è´¥"

**Q: è®­ç»ƒä¸­é€”ä¸­æ–­äº†æ€ä¹ˆåŠï¼Ÿ**  
A: é‡æ–°è¿è¡Œå¯¹åº”çš„è„šæœ¬ï¼Œå‚æ•°ä¸­æœ‰ `--overwrite_output_dir` ä¼šä»å¤´å¼€å§‹

**Q: å¯ä»¥ä¿®æ”¹è®­ç»ƒå‚æ•°å—ï¼Ÿ**  
A: å¯ä»¥ç›´æ¥ç¼–è¾‘å¯¹åº”çš„ `.sh` è„šæœ¬æ–‡ä»¶ï¼Œä¿®æ”¹å‚æ•°åé‡æ–°è¿è¡Œ

**Q: å¦‚ä½•æŸ¥çœ‹è®­ç»ƒç²¾åº¦å’ŒæŸå¤±ï¼Ÿ**  
A: æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨ TensorBoardï¼ˆCode2NL + CodeT5 ä»»åŠ¡æ”¯æŒï¼‰

```bash
# å¯åŠ¨ TensorBoard
tensorboard --logdir=./models/code2nl/codet5/base/tensorboard
```

